# Migration `20200807234930-equivalent-to-graph-cool-schema`

This migration has been generated by briansayles at 8/7/2020, 11:49:30 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Game" AS ENUM ('NLHE', 'PLO', 'LHE', 'L7S', 'HORSE', 'HOSE', 'CAP');

CREATE TYPE "CostType" AS ENUM ('Buyin', 'Rebuy', 'Addon', 'Bounty', 'House', 'Charity');

CREATE TABLE "public"."Contact" (
"emails" text []  ,
"id" text  NOT NULL ,
"name" text  NOT NULL DEFAULT E'',
"phones" text []  ,
"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Table" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" text  NOT NULL ,
"name" text  NOT NULL DEFAULT E'1',
"tournamentId" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Seat" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" text  NOT NULL ,
"number" integer  NOT NULL DEFAULT 1,
"playerId" text  NOT NULL ,
"tableId" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Tag" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" text  NOT NULL ,
"name" text  NOT NULL DEFAULT E'',
"tournamentId" text  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Time" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
"id" text  NOT NULL ,
"lastRequestedAt" timestamp(3)  NOT NULL ,
"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Buy" ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."Chip" ALTER COLUMN "color" SET DEFAULT E'#fff',
ALTER COLUMN "denom" SET DEFAULT 100,
ALTER COLUMN "qtyAvailable" DROP NOT NULL,
ALTER COLUMN "rimColor" DROP NOT NULL,
ALTER COLUMN "textColor" DROP NOT NULL,
ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."Cost" ALTER COLUMN "chipStack" SET DEFAULT 1000,
DROP COLUMN "costType",
ADD COLUMN "costType" "CostType" NOT NULL DEFAULT E'Buyin',
ALTER COLUMN "price" SET DEFAULT 20,
ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."PayoutLevel" ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."Player" ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."Segment" ALTER COLUMN "ante" DROP NOT NULL,
ALTER COLUMN "bBlind" DROP NOT NULL,
ALTER COLUMN "duration" SET DEFAULT 20,
DROP COLUMN "game",
ADD COLUMN "game" "Game" NOT NULL DEFAULT E'NLHE',
ALTER COLUMN "sBlind" DROP NOT NULL,
ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."Timer" ALTER COLUMN "active" SET DEFAULT false,
ALTER COLUMN "backgroundColor" DROP NOT NULL,
ALTER COLUMN "elapsed" SET DEFAULT 0,
ALTER COLUMN "endOfRoundSpeech" DROP NOT NULL,
ALTER COLUMN "oneMinuteRemainingSpeech" DROP NOT NULL,
ALTER COLUMN "playEndOfRoundSound" SET DEFAULT true,
ALTER COLUMN "playOneMinuteRemainingSound" SET DEFAULT true,
ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."Tournament" ADD COLUMN "childrenUpdatedAt" timestamp(3)   ,
ADD COLUMN "playerId" text   ,
ALTER COLUMN "comments" DROP NOT NULL,
DROP COLUMN "game",
ADD COLUMN "game" "Game" NOT NULL DEFAULT E'NLHE',
ALTER COLUMN "subtitle" DROP NOT NULL,
ALTER COLUMN "title" SET DEFAULT E'',
ALTER COLUMN "updatedAt" DROP DEFAULT;

ALTER TABLE "public"."User" ALTER COLUMN "credits" DROP NOT NULL,
ALTER COLUMN "name" SET DEFAULT E'',
ALTER COLUMN "updatedAt" DROP DEFAULT;

CREATE UNIQUE INDEX "Seat_playerId" ON "public"."Seat"("playerId")

ALTER TABLE "public"."Contact" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Table" ADD FOREIGN KEY ("tournamentId")REFERENCES "public"."Tournament"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Seat" ADD FOREIGN KEY ("playerId")REFERENCES "public"."Player"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Seat" ADD FOREIGN KEY ("tableId")REFERENCES "public"."Table"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("tournamentId")REFERENCES "public"."Tournament"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Tournament" ADD FOREIGN KEY ("playerId")REFERENCES "public"."Player"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200720000302-made-auth-fields-optional--temporary..20200807234930-equivalent-to-graph-cool-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,23 +1,32 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model User {
-  id   String @default(cuid()) @id
+  id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   authProvider AuthProvider?
-  name String
-  credits Int @default(0)
+  name String @default("")
+  credits Int? @default(0)
   tournaments Tournament[]
   players Player[]
+  contacts Contact[]
 }
+model Contact {
+  id String @default(cuid()) @id
+  name String @default("")
+  phones String[]
+  emails String[]
+  user User @relation(fields: [userId], references: [id])
+  userId String
+}
 model AuthProvider {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
@@ -36,64 +45,96 @@
 model Tournament {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
-  user User? @relation(fields: [userId], references: [id])
-  userId String?
-  title String
-  subtitle String
-  comments String
-  game String
+  updatedAt DateTime @updatedAt
+  title String @default("")
+  subtitle String?
+  comments String?
   segments Segment[]
   chips Chip[]
   costs Cost[]
   timer Timer?
   payoutLevels PayoutLevel[]
+  childrenUpdatedAt DateTime?
+  game Game @default(NLHE)
+  tables Table[]
+  tags Tag[]
 }
+model Table {
+  id String @default(uuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name String @default("1")
+  seats Seat[]
+  tournament Tournament @relation(fields: [tournamentId], references: [id])
+  tournamentId String
+}
+
+model Seat  {
+  id String @default(uuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  number Int @default(1)
+  player Player @relation(fields: [playerId], references: [id])
+  playerId String
+  table Table @relation(fields: [tableId], references: [id])
+  tableId String
+}
+
+model Tag {
+  id String @default(uuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name String @default("")
+  tournament Tournament @relation(fields: [tournamentId], references: [id])
+  tournamentId String
+}
+
+
 model Segment {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   tournament Tournament @relation(fields: [tournamentId], references: [id])
   tournamentId String
-  duration Int
-  sBlind Int
-  bBlind Int
-  ante Int
-  game String
-  }
+  duration Int @default(20)
+  sBlind Int?
+  bBlind Int?
+  ante Int?
+  game Game @default(NLHE)
+}
 model Chip {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   tournament Tournament @relation(fields: [tournamentId], references: [id])
   tournamentId String
-  denom Int
-  color String
-  rimColor String
-  textColor String
-  qtyAvailable Int
+  denom Int @default(100)
+  color String @default("#fff")
+  rimColor String?
+  textColor String?
+  qtyAvailable Int?
 }
 model Cost {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   tournament Tournament @relation(fields: [tournamentId], references: [id])
   tournamentId String
-  costType String
-  price Int
-  chipStack Int
+  costType CostType @default(Buyin)
+  price Int @default(20)
+  chipStack Int @default(1000)
   buys Buy[]
 }
 model Buy {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   cost Cost @relation(fields: [costId], references: [id])
   costId String
   player Player? @relation(fields: [playerId], references: [id])
   playerId String?
@@ -101,36 +142,64 @@
 model Player {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   user User @relation(fields: [userId], references: [id])
   userId String
   name String?
   buys Buy[]
+  seat Seat?
+  tournaments Tournament[]
 }
 model Timer {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   tournament Tournament @relation(fields: [tournamentId], references: [id])
   tournamentId String
-  active Boolean
-  elapsed Int
-  oneMinuteRemainingSpeech String
-  playOneMinuteRemainingSound Boolean
-  endOfRoundSpeech String
-  playEndOfRoundSound Boolean
-  backgroundColor String
+  active Boolean @default(false)
+  elapsed Int @default(0)
+  oneMinuteRemainingSpeech String?
+  playOneMinuteRemainingSound Boolean @default(true)
+  endOfRoundSpeech String?
+  playEndOfRoundSound Boolean @default(true)
+  backgroundColor String?
 }
 model PayoutLevel {
   id String @default(uuid()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
   tournament Tournament @relation(fields: [tournamentId], references: [id])
   tournamentId String
   levelNumber Int
   payCount Int
   playerCount Int
+}
+
+model Time {
+  id String @default(uuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  lastRequestedAt DateTime
+}
+
+enum Game {
+  NLHE
+  PLO
+  LHE
+  L7S
+  HORSE
+  HOSE
+  CAP
+}
+
+enum CostType {
+  Buyin
+  Rebuy
+  Addon
+  Bounty
+  House
+  Charity
 }
```


